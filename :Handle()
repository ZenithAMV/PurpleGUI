local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hum : Humanoid = char:WaitForChild("Humanoid")
local hrp : BasePart= char:WaitForChild("HumanoidRootPart")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local GUI = player.PlayerGui.AutoTech
local Father = GUI.Father
local Config = GUI.Config

local Open = false

local CloseButton = Father.Main.Close

local welcomeText = "Welcome To ZENITHAMV_ Auto Tech Script!"

local Camera = workspace.CurrentCamera

function slashScreen(rep : number)
	for i = 1, rep do
		local randomRotation = math.random(-180, 180)
		local randomUDIM2 = UDim2.new(0, math.random(600, 900), 0, math.random(600, 900))

		local clon = Config.SlashImage:Clone()
		local soun = Config.Slash:Clone()
		
		clon.Parent = Father.Slashes
		clon.Size = UDim2.new(0,0,0,0)
		task.wait(0.1)
		
		TweenService:Create(clon,TweenInfo.new(0.1),{Size = randomUDIM2, Rotation = randomRotation}):Play()
		
		soun.Parent = Father.Slashes
		soun:Play()
		game.Debris:AddItem(clon,1.1)
		game.Debris:AddItem(soun,0.8)
		
		task.wait(0.1)
		
		TweenService:Create(clon,TweenInfo.new(0.3),{ImageTransparency = 1}):Play()
	end
end

function Lethal()
	hum.AutoRotate = false
	local function Init(delay)
		delay = delay or 0.5
		local originalCFrame = hrp.CFrame
		local turnedCFrame = originalCFrame * CFrame.Angles(0, math.rad(180), 0)

		hrp.CFrame = turnedCFrame

		task.wait(delay)
		hrp.CFrame = originalCFrame
	end

	Init(0.17)
	hum.AutoRotate = true
end

function Twisted()
	hum.AutoRotate = false
	local function Init(delay)
		delay = delay or 0.5
		local originalCFrame = hrp.CFrame
		local turnedCFrame = originalCFrame * CFrame.Angles(0, math.rad(-40), 0)

		hrp.CFrame = turnedCFrame

		task.wait(delay)
		hrp.CFrame = originalCFrame * CFrame.Angles(0, math.rad(30), 0)

		task.wait(0.5)
		hrp.CFrame = originalCFrame
	end

	Init(0.1)
	hum.AutoRotate = true
end

function createTechGUI(TN : string)
	
	local count = 1
	for _, child in pairs(Father.Main.Holder:GetChildren()) do
		if child:IsA("ImageLabel") and string.match(child.Name, "^Tech%d*$") then
			count = count + 1
		end
	end
	
	local Concept = Config.Tech:Clone()
	Concept.Parent = Father.Main.Holder

	local Key = Concept.Key.Value

	local TechName = Concept.TechName
	
	local Edit = TechName.Edit
	
	if count == 1 then
		Concept.Name = "Tech1"
	else
		Concept.Name = "Tech"..tostring(count)
	end
	
	if TN == "Lethal" then
		Key = "R"
		TechName.Text = "Instant Lethal"
		
		UserInputService.InputBegan:Connect(function(inp,gpe)
			if not gpe then
				if inp.KeyCode == Enum.KeyCode[Key] then
					Lethal()
				end
			end
		end)
		
	elseif TN == "Twisted" then
		Key = "T"
		TechName.Text = "Instant Twisted"
		
		UserInputService.InputBegan:Connect(function(inp, gpe)
			if not gpe then
				if inp.KeyCode == Enum.KeyCode[Key] then
					Twisted()
				end
			end
		end)
		
	end
	
	local Textbox = Concept.TechName.Key
	
	Textbox.Text = Key
	
	Textbox.PlaceholderText = "..."
	
	Config:SetAttribute(TN,Key)
	
	Textbox.FocusLost:Connect(function(enter)
		
		Key = Textbox.Text
		Textbox.TextEditable = false
		
		if enter then
			for index, attribute in Config:GetAttributes() do
				if attribute == Textbox.Text then
					local notif = Config.Notif:Clone()

					if not Father:FindFirstChild("Notifs"):FindFirstChild("Notif") then
						notif.Parent = Father:FindFirstChild("Notifs")
						notif.Text = "THE ".. Textbox.Text .. " KEY IS ALREADY BEING USED OR DOESNT EXIST"
						
						Textbox.Text = "?"
						Textbox.TextEditable = true
						
						Config:SetAttribute(TN,"nil")
						
						local er = Config.Error:Clone()
						er.Parent = Father:FindFirstChild("Notifs")
						er:Play()
						
						game.Debris:AddItem(notif,1)
						game.Debris:AddItem(er,er.TimeLength + 0.1)
						
						task.wait(0.5)
						
						TweenService:Create(notif,TweenInfo.new(0.5),{TextTransparency = 1}):Play()
						
					end
				end
			end
		end
	end)
	
	Edit.MouseButton1Click:Connect(function()
		Textbox.TextEditable = true
	end)

end

createTechGUI("Lethal")
createTechGUI("Twisted")

for i, ui in GUI:GetDescendants() do
	if ui:IsA("ImageLabel") then
		ui.ImageTransparency = 1
		ui.BackgroundTransparency =1
	elseif ui:IsA("ImageButton") then
		ui.ImageTransparency = 1
		ui.BackgroundTransparency = 1
	elseif ui:IsA("TextLabel") then
		ui.TextTransparency = 1
		ui.BackgroundTransparency = 1
		ui.TextStrokeTransparency = 1
	elseif ui:IsA("UIStroke") then
		ui.Transparency = 1
	elseif ui:IsA("TextBox") then
		ui.TextTransparency = 1
		ui.BackgroundTransparency = 1
		ui.TextStrokeTransparency = 1
	elseif ui:IsA("TextButton") then
		ui.TextTransparency = 1
		ui.BackgroundTransparency = 1
		ui.TextStrokeTransparency = 1
	end
end

-- // WELCOME MESSAGE
local TempMessage = player.PlayerGui.Temp.Welcome
TempMessage.Position = UDim2.new(0.475,0,1.5,0)

local messageUp = TweenService:Create(TempMessage,TweenInfo.new(1.3,Enum.EasingStyle.Sine,Enum.EasingDirection.In),{Position = UDim2.new(0.483,0,0.44,0) })
messageUp:Play()

messageUp.Completed:Wait()

task.wait(0.2)

local messageLeft = TweenService:Create(TempMessage,TweenInfo.new(0.8,Enum.EasingStyle.Sine,Enum.EasingDirection.In),{Position = UDim2.new(0.386,0,0.44,0)})
messageLeft:Play()
messageLeft.Completed:Wait()

task.wait(0.2)

TempMessage.AnchorPoint = Vector2.new(0.5,0.5)
TempMessage.Position = UDim2.new(0.402, 0,0.44, 0)

local messageOpen = TweenService:Create(TempMessage,TweenInfo.new(0.8,Enum.EasingStyle.Sine,Enum.EasingDirection.In),{Size = UDim2.new(0,349,0,50),Position = UDim2.new(0.5,0,0.44,0)})
messageOpen:Play()
messageOpen.Completed:Wait()

task.wait(0.4)

TempMessage.TextTransparency = 0

local function typewriterEffect(textObject, fullText, speed)
	for i = 1, #fullText do
		textObject.Text = string.sub(fullText, 1, i)
		local talkSound = Config.Talk:Clone()
		talkSound.Parent = player.PlayerGui
		talkSound:Play()

		game.Debris:AddItem(talkSound,talkSound.TimeLength + 0.1)

		task.wait(speed)
		if i == #fullText then
			break
		end
	end
end

typewriterEffect(TempMessage, welcomeText, 0.05)

task.wait(0.05 * #welcomeText)

task.wait(0.1)

TweenService:Create(TempMessage,TweenInfo.new(1),{TextTransparency = 1}):Play()
TweenService:Create(TempMessage,TweenInfo.new(1),{BackgroundTransparency = 1}):Play()
TweenService:Create(TempMessage.UIStroke,TweenInfo.new(1),{Transparency = 1}):Play()

task.wait(1.7)

TempMessage.Parent:Destroy()

for i, ui in GUI:GetDescendants() do
	if ui:IsA("ImageLabel") then
		TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0}):Play()
	elseif ui:IsA("ImageButton") then
		if ui.Name == "Close" then
			TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0,BackgroundTransparency = 0}):Play()
		else
			TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0}):Play()
		end	
	elseif ui:IsA("TextLabel") then
		if ui.Name == "Soon" or ui.Name == "Text" then
			TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0,TextStrokeTransparency = 0}):Play()
		else
			TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
		end
	elseif ui:IsA("UIStroke") then
		if ui.Name == "C" then
			TweenService:Create(ui,TweenInfo.new(1),{Transparency = 0.2}):Play()
		else
			TweenService:Create(ui,TweenInfo.new(1),{Transparency = 0.7}):Play()
		end
	elseif ui:IsA("TextBox") then
		TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
	elseif ui:IsA("TextButton") then
		TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
	end
end

task.wait(1)

Open = true

CloseButton.Activated:Connect(function()
	if Open == true then
		print("clicked close")
		slashScreen(3)

		task.wait(1)

		for i, ui in GUI:GetDescendants() do
			if ui:IsA("ImageLabel") then
				TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 1}):Play()
			elseif ui:IsA("ImageButton") then
				if ui.Name == "Close" then
					TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 1,BackgroundTransparency = 1}):Play()
				else
					TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 1}):Play()
				end	
			elseif ui:IsA("TextLabel") then
				if ui.Name == "Soon" or ui.Name == "Text" then
					TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 1,TextStrokeTransparency = 1}):Play()
				else
					TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 1}):Play()
				end
			elseif ui:IsA("UIStroke") then
				if ui.Name == "C" then
					TweenService:Create(ui,TweenInfo.new(1),{Transparency = 1}):Play()
				else
					TweenService:Create(ui,TweenInfo.new(1),{Transparency =1}):Play()
				end
			elseif ui:IsA("TextBox") then
				TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 1}):Play()
			elseif ui:IsA("TextButton") then
				TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 1}):Play()
			end
		end
        Open = false
	end	
end)

UserInputService.InputBegan:Connect(function(inp,gpe)
	if not gpe and not Open then
		if inp.KeyCode == Enum.KeyCode.P then
			for i, ui in GUI:GetDescendants() do
				if ui:IsA("ImageLabel") then
					TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0}):Play()
				elseif ui:IsA("ImageButton") then
					if ui.Name == "Close" then
						TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0,BackgroundTransparency = 0}):Play()
					else
						TweenService:Create(ui,TweenInfo.new(1),{ImageTransparency = 0}):Play()
					end	
				elseif ui:IsA("TextLabel") then
					if ui.Name == "Soon" or ui.Name == "Text" then
						TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0,TextStrokeTransparency = 0}):Play()
					else
						TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
					end
				elseif ui:IsA("UIStroke") then
					if ui.Name == "C" then
						TweenService:Create(ui,TweenInfo.new(1),{Transparency = 0.2}):Play()
					else
						TweenService:Create(ui,TweenInfo.new(1),{Transparency = 0.7}):Play()
					end
				elseif ui:IsA("TextBox") then
					TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
				elseif ui:IsA("TextButton") then
					TweenService:Create(ui,TweenInfo.new(1),{TextTransparency = 0}):Play()
				end
			end
			Open = true
		end
	end
end)
